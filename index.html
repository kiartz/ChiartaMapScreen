<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Drag Test</title>
  <style>
    body { margin:0; height:100vh; display:flex; justify-content:center; align-items:center; background:#111; }
    #playground { position:relative; width:90vw; height:90vh; background:#222; border:2px solid #555; overflow:hidden; touch-action:none; }
    #box { position:absolute; left:50px; top:50px; width:150px; height:150px; background:#45b8ff; border-radius:8px; cursor:grab; touch-action:none; user-select:none; }
    #box.dragging { cursor:grabbing; }
  </style>
</head>
<body>
  <div id="playground">
    <div id="box"></div>
  </div>

<script>
(() => {
  const box = document.getElementById('box');
  const playground = document.getElementById('playground');

  let dragData = null;

  function getEventPos(e) {
    if (e.touches && e.touches[0]) e = e.touches[0];
    return { x: e.clientX, y: e.clientY };
  }

  function startDrag(e) {
    e.preventDefault();
    const pos = getEventPos(e);
    const rect = box.getBoundingClientRect();
    dragData = {
      offsetX: pos.x - rect.left,
      offsetY: pos.y - rect.top
    };
    box.classList.add('dragging');
    document.addEventListener('mousemove', onDragMove);
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchmove', onDragMove, { passive: false });
    document.addEventListener('touchend', endDrag);
  }

  function onDragMove(e) {
    if (!dragData) return;
    e.preventDefault();
    const pos = getEventPos(e);
    const pgRect = playground.getBoundingClientRect();

    let newX = pos.x - pgRect.left - dragData.offsetX;
    let newY = pos.y - pgRect.top - dragData.offsetY;

    // Limiti dentro al playground
    newX = Math.max(0, Math.min(newX, pgRect.width - box.offsetWidth));
    newY = Math.max(0, Math.min(newY, pgRect.height - box.offsetHeight));

    box.style.left = newX + 'px';
    box.style.top = newY + 'px';
  }

  function endDrag() {
    dragData = null;
    box.classList.remove('dragging');
    document.removeEventListener('mousemove', onDragMove);
    document.removeEventListener('mouseup', endDrag);
    document.removeEventListener('touchmove', onDragMove);
    document.removeEventListener('touchend', endDrag);
  }

  box.addEventListener('mousedown', startDrag);
  box.addEventListener('touchstart', startDrag, { passive: false });
})();
</script>
</body>
</html>
